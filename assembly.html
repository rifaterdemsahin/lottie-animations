<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D CV Assembly</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
        canvas { display: block; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            background-color: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            display: none; /* Hidden by default */
            pointer-events: none; /* Don't let it block mouse events */
        }
    </style>
</head>
<body>
    <div id="info"></div> 

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ======== 0. CV DATA ========
        // Normally in its own file, but embedded here for a single-file example.
        const cvData = {
          name: "Your Name",
          title: "Creative Developer",
          categories: [
            {
              name: "Skills",
              items: [
                { name: "JavaScript" }, { name: "Three.js" }, { name: "React" },
                { name: "Node.js" }, { name: "GLSL" }
              ]
            },
            {
              name: "Experience",
              items: [
                { name: "Lead Developer @ TechCorp" },
                { name: "Frontend Dev @ WebWidgets" },
                { name: "Junior Dev @ SiteSolutions" }
              ]
            },
            {
              name: "Projects",
              items: [
                { name: "Project Aurora (WebVR)" },
                { name: "E-commerce Platform" },
                { name: "DataVis Tool" }
              ]
            }
          ]
        };

        // ======== 1. BASIC SETUP ========
        
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 30;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(10, 10, 10);
        scene.add(pointLight);

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const infoBox = document.getElementById('info');
        let intersectedObject = null;
        
        // Arrays to hold objects for animation
        const planetPivots = [];
        const moonPivots = [];
        
        // ======== 2. DATA-DRIVEN SCENE CREATION ========

        const solarSystem = new THREE.Group();
        scene.add(solarSystem);

        // "Sun" (You)
        const sunGeometry = new THREE.SphereGeometry(4, 32, 32);
        const sunMaterial = new THREE.MeshStandardMaterial({ 
            color: 0xffcc00, 
            emissive: 0xffcc00, 
            emissiveIntensity: 0.5 
        });
        const sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);
        sunMesh.userData = { name: cvData.name, info: cvData.title };
        solarSystem.add(sunMesh);

        // "Planets" (Categories) and "Moons" (Items)
        const planetColors = [0xff6347, 0x4682b4, 0x32cd32];

        cvData.categories.forEach((category, i) => {
            const planetPivot = new THREE.Group();
            solarSystem.add(planetPivot);

            const planetGeometry = new THREE.SphereGeometry(1.5, 32, 32);
            const planetMaterial = new THREE.MeshStandardMaterial({ color: planetColors[i % planetColors.length] });
            const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
            
            const planetDistance = 10 + i * 8;
            planetMesh.position.x = planetDistance;
            planetMesh.userData = { name: category.name, info: `${category.items.length} items` };
            
            planetPivot.add(planetMesh);
            planetPivots.push(planetPivot); // Add to animation list

            // This group holds the planet and its moons
            const planetSystem = new THREE.Group();
            planetMesh.add(planetSystem);

            // Add orbit line
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(
                new THREE.Path().absellipse(0, 0, planetDistance, planetDistance, 0, Math.PI * 2, false).getPoints(50)
            );
            const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.2 });
            const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
            orbitLine.rotation.x = Math.PI / 2;
            solarSystem.add(orbitLine);
            
            // Set initial scale for assembly animation
            planetPivot.scale.set(0.01, 0.01, 0.01);

            // "Moons" (Items)
            category.items.forEach((item, j) => {
                const moonPivot = new THREE.Group();
                planetSystem.add(moonPivot); 

                const moonGeometry = new THREE.SphereGeometry(0.5, 16, 16);
                const moonMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa });
                const moonMesh = new THREE.Mesh(moonGeometry, moonMaterial);
                
                const moonDistance = 3 + j * 0.8;
                moonMesh.position.x = moonDistance;
                moonMesh.userData = { name: item.name };
                
                moonPivot.add(moonMesh);
                moonPivots.push(moonPivot); // Add to animation list

                moonPivot.rotation.y = Math.random() * Math.PI * 2;
                moonPivot.rotation.x = Math.random() * 0.5 - 0.25;
                
                // Set initial scale for assembly animation
                moonPivot.scale.set(0.01, 0.01, 0.01);
            });

            planetPivot.rotation.y = Math.random() * Math.PI * 2;
        });

        // ======== 3. INTERACTIVITY (HOVER) ========

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(solarSystem.children, true);

            if (intersects.length > 0) {
                if (intersectedObject !== intersects[0].object && intersects[0].object.userData.name) {
                    intersectedObject = intersects[0].object;
                    const data = intersectedObject.userData;
                    
                    infoBox.style.display = 'block';
                    infoBox.style.left = `${event.clientX + 10}px`;
                    infoBox.style.top = `${event.clientY + 10}px`;
                    infoBox.innerHTML = `<strong>${data.name}</strong><br>${data.info || ''}`;
                }
            } else if (intersectedObject) {
                intersectedObject = null;
                infoBox.style.display = 'none';
            }
        }
        window.addEventListener('mousemove', onMouseMove);

        // ======== 4. ANIMATION LOOP ("PROCESS UPDATE") ========
        
        // We use a clock to manage the assembly animation time
        const clock = new THREE.Clock();
        const animationDuration = 3; // 3 seconds for assembly
        
        // Define the scales we are animating between
        const initialScale = new THREE.Vector3(0.01, 0.01, 0.01);
        const targetScale = new THREE.Vector3(1, 1, 1);
        
        let assemblyComplete = false;

        function animate() {
            requestAnimationFrame(animate);

            const elapsedTime = clock.getElapsedTime();

            // --- Part 1: The Assembly Animation ("Process Update") ---
            
            if (!assemblyComplete) {
                // Get progress (a value from 0.0 to 1.0)
                let progress = elapsedTime / animationDuration;
                
                if (progress >= 1.0) {
                    progress = 1.0;
                    assemblyComplete = true; // Stop this part from running
                }
                
                // This creates a smooth "ease-out" curve
                const easedProgress = 1 - Math.pow(1 - progress, 4);

                // Animate all planets
                for (const pivot of planetPivots) {
                    pivot.scale.lerpVectors(initialScale, targetScale, easedProgress);
                }
                // Animate all moons
                for (const pivot of moonPivots) {
                    pivot.scale.lerpVectors(initialScale, targetScale, easedProgress);
                }
            }
            
            // --- Part 2: The Continuous Orbital Animation ---
            // This runs both during and after the assembly
            
            // Rotate planets around the sun
            planetPivots.forEach((pivot) => {
                pivot.rotation.y += 0.005; 
            });
            
            // Rotate moons around their planets
            moonPivots.forEach((pivot) => {
                pivot.rotation.y += 0.015;
            });


            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start the animation
        animate();
        
    </script>
</body>
</html>
